<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html><head><title>How Templates Work - Torque</title><style type="text/css" media="all">
          @import url("./style/maven-base.css");
          
          @import url("./style/maven-theme.css");</style><link rel="stylesheet" href="./style/print.css" type="text/css" media="print"></link><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"></meta><meta name="author" content="Greg Monroe"></meta><meta name="email" content="monroe@dukece.com"></meta></head><body class="composite"><div id="banner"><a href="http://db.apache.org/" id="organizationLogo"><img alt="Apache Software Foundation" src="./images/db-logo-white.png"></img></a><a href="http://db.apache.org/torque/releases/torque-3.3/generator/" id="projectLogo"><img alt="Torque generator" src="./images/torque-logo-new.png"></img></a><div class="clear"><hr></hr></div></div><div id="breadcrumbs"><div class="xleft">Last published: 28 February 2008
                <span class="separator">|</span> Doc for  3.3
                </div><div class="xright"></div><div class="clear"><hr></hr></div></div><div id="leftColumn"><div id="navcolumn"><div id="menuTorque"><h5>Torque</h5><ul><li class="none"><a href="../../../index.html">Overview</a></li><li class="none"><a href="../../../status.html">News and Status</a></li><li class="none"><a href="../../../download.html">Downloads</a></li><li class="none"><a href="../../../addons.html">Addons</a></li><li class="none"><a href="../../../changes-report.html">Changes</a></li><li class="none"><a href="http://wiki.apache.org/db-torque/" class="externalLink" title="External Link">Wiki</a></li><li class="none"><a href="../../../issue-tracking.html">Issue tracker</a></li><li class="none"><a href="../../../mail-lists.html">Mailing lists</a></li><li class="none"><a href="../../../tools/index.html">Tools</a></li><li class="collapsed"><a href="../../../developer-info/index.html">Developer Information</a></li></ul></div><div id="menuModule_Documentation"><h5>Module Documentation</h5><ul><li class="none"><a href="../../../documentation/index.html">Overview</a></li><li class="expanded"><a href="../../../documentation/torque-3.3.html">Torque 3.3</a><ul><li class="expanded"><a href="index.html">Generator</a><ul><li class="none"><a href="tasks-reference.html">Tasks Reference</a></li><li class="none"><a href="schema-reference.html">Schema Reference</a></li><li class="none"><a href="properties-reference.html">Properties Reference</a></li><li class="none"><a href="database.dtd.txt" class="newWindow" title="New Window" target="_blank">database.dtd</a></li><li class="none"><strong><a href="how-templates-work.html">How Templates work</a></strong></li><li class="none"><a href="custom-templates.html">Custom Templates</a></li><li class="none"><a href="dependencies.html">Dependencies</a></li><li class="collapsed"><a href="maven-reports.html">Project Reports</a></li></ul></li><li class="collapsed"><a href="../maven-plugin/index.html">Maven 1 Plugin</a></li><li class="none"><a href="../maven2-plugin/index.html" class="newWindow" title="New Window" target="_blank">Maven 2 Plugin</a></li><li class="collapsed"><a href="../runtime/index.html">Runtime</a></li><li class="collapsed"><a href="../tutorial/index.html">Tutorial</a></li><li class="collapsed"><a href="../village/index.html">Village</a></li></ul></li><li class="collapsed"><a href="../../../documentation/previous-releases.html">Previous releases</a></li></ul></div><div id="menuOther_Documentation"><h5>Other Documentation</h5><ul><li class="none"><a href="../../../version-specific/supported-databases.html">Supported Databases</a></li><li class="collapsed"><a href="../../../version-specific/database-howtos/index.html">Database Howtos</a></li><li class="collapsed"><a href="../../../version-specific/other-howtos/index.html">Other Howtos</a></li></ul></div><div id="menuProject_Documentation"><h5>Project Documentation</h5><ul><li class="collapsed"><a href="../../../project-info.html">Project info</a></li><li class="collapsed"><a href="../../../project-reports.html">Site Project Reports</a></li></ul></div><div id="legend"><h5>Legend</h5><ul><li class="externalLink">External Link</li><li class="newWindow">Opens in a new window</li></ul></div><a href="http://maven.apache.org/" title="Built by Maven" id="poweredBy"><img alt="Built by Maven" src="./images/logos/maven-button-1.png"></img></a></div></div><div id="bodyColumn"><div class="contentBox"><div class="section"><a name="How_Templates_Work"></a><h2>How Templates Work</h2>
    <p>
    <b>Table of Contents</b>
    </p>
    <p>
      <ol>
        <li>
          <a href="#Introduction">Introduction</a>
        </li>
        <li>
          <a href="#Process_Overview">
            Process Overview
          </a>
        </li>
        <li>
          <a href="#Template_Files">
            Template Files
          </a>
        </li>
        <li>
          <a href="#Template_Variables">
            Template Variables
          </a>
        </li>
        <li>
          <a href="#The_XML_Custom_Option_Element">
            The XML Custom Option Element
          </a>
        </li>
      </ol>
    </p>
  </div><div class="section"><a name="Introduction"></a><h2>Introduction</h2>
    <p>
      This section explains how the generator works internally.  If you
      are happy with the generator as it is, you need not read this section.
      It is not intended to be a tutorial, but rather a overview framework 
      that points people interested in enhancing or creating custom 
      templates to the resources needed to work with Torque templates.
    </p>
    <p>
      Once you understand the Template internals, see the 
      <a href="custom-templates.html">Custom Templates</a> document for
      information on how to use it. 
    </p>
    
  </div><div class="section"><a name="Process_Overview"></a><h2>Process Overview</h2>
    <p>
      The Torque Generator is designed to do many different tasks. (see
      the <a href="tasks-reference.html">Tasks Reference</a> documentation).  
      These tasks generate text based output like: Java code; SQL 
      scripts; etc.  Many of these outputs specific to the database type
      specified in the generation setting.
    </p>
    <p>
      The Generator tasks are based on a Java based template engine
      called <a href="http://velocity.apache.org" class="externalLink" title="External Link">Velocity</a> (in
      particular, the Texen component).  The Velocity engine uses 
      a set of task specific template files written in the 
      Velocity Template Language (VTL), the XML schema info, and 
      project build properties to produce the required output.
    </p>
    <p>
      To understand how the Torque template files work, you should become 
      familiar with the VTL syntax by reviewing the 
      <a href="http://velocity.apache.org/docs/user-guide.html" class="externalLink" title="External Link">Velocity
      user guide</a>.
    </p>
  </div><div class="section"><a name="Template_Files"></a><h2>Template Files</h2>
    <p>
      The Torque template files are plain text VTL files with the extention of 
      ".vm".  These files are packaged in the 
      torque-gen-templates&lt;version&gt;.jar in the lib directory of the 
      binary distribution. This jar file can be unpacked to access this files.
      Or alternatively, you can find them under the torque/templates/src 
      directory in the source distribution or SVN repository.
    </p>
    <p>
      The template files are organized under a main directory called
      templates which has five or so different directory branches under it. 
      Each of these branches is roughly related to a Torque Task.
      To learn which directories and templates apply to which Generator task, 
      you need to identify the Control.vm template associated 
      with that task.  The Control.vm files are the main entry points for
      all tasks.
    </p>
    <p>
      The easiest way to find a task's Control.vm file is to use the 
      default.properties file (located in the root directory of the binary 
      distribution). Search thru this file for properties 
      that start with "torque.templates."  The ending part of the property
      key is generally the task name and the value is the associated Control.vm
      file.  E.g. the property, "torque.template.sql = sql/base/Control.vm", 
      means the sql task Control file is the templates/sql/base/Control.vm file
      in the template jar.      
    </p>
    <p>
      These Control.vm files can be examined to understand the overall flow
      of a task's process and to find the main template files that will 
      be parsed to produce various parts of the output. Note that in some
      cases, the parsed template files may call other templates.
    </p>
  </div><div class="section"><a name="Template_Variables"></a><h2>Template Variables</h2>
    <p>
      Once you start looking at the VTL code in the templates, you'll wonder 
      where all the Velocity variables are getting set.  Well, there are two 
      places these come from.
    </p>
    <p>
      First, all the torque.* build properties defined in the
      default.properties file and any project related property file are passed
      into the templates.  These are converted to Velocity format by removing
      the "torque." prefix, removing the remaining dots (".") and capitalizing
      the letter after it.  E.g. torque.output.dir becomes $outputDir.
    </p>
    <p>
      Second, the *-schema.xml files are converted into the OM objects in the 
      <code>org.apache.torque.engine.database.model</code> package.  These are 
      passed to the  Velocity controller as object variables, like $dataModel.  
      In Velocity, any object property (e.g. getProp), can be referred to by 
      $objectVar.prop.  In addition, any methods in this object can also be 
      called by referring to them as $objectVar.getSomething( parm, parm ).  
    </p>
  </div><div class="section"><a name="The_XML_Custom_Option_Element"></a><h2>The XML Custom Option Element</h2>
    <p>
      With the release of Version 3.3, the XML DTD supports an
      &lt;option key="key" value="value"&gt; element 
      intended for use by custom templates. Zero or more of these elements 
      can be nested (as the first item) inside the dataset, table, column, 
      foreign-key, index, and unique schema elements.  For example:
    </p>
    <p>
      <ul>
        &lt;table ....&gt;
           &lt;option key="mysql-table-type" value="INNOB"/&gt;
           ....
        &lt;/table&gt;
      </ul>
    </p>
    <p>
      These key/value attributes will then populate the options map in the 
      associated database model class.  Custom templates can access these
      values with code like:
    </p>
    <p>
      <ul>
        #if ( {table.getOption("mysql-table-type")})
          ${table.getOption("mysql-table-type")}
        #end
      </ul>
    </p>
  </div></div></div><div class="clear"><hr></hr></div><div id="footer"><div class="xright">© 2000-2008, Apache Software Foundation</div><div class="clear"><hr></hr></div></div></body></html>